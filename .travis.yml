language: java

jdk:
  - oraclejdk8

notifications:
  email: false

sudo: required

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y pv

env:
  global:
    # Make sure there is enough memory to complete the build
    - MAVEN_OPTS="-Xms1024m -Xmx2048m -Xss1m -XX:+UseConcMarkSweepGC -XX:+CMSClassUnloadingEnabled"

  matrix:
    # Unit tests
    - TEST_ARGS=""
    # Integration tests (also runs the spec pipelines in emma-language with compilation)
    - TEST_ARGS="-PIT -pl emma-language"
    - TEST_ARGS="-PIT -pl emma-examples/emma-examples-spark"
    - TEST_ARGS="-PIT -pl emma-examples/emma-examples-flink"
cache:
  directories:
    $HOME/.m2

script:
  # Enable exit code propagation through pipes
  - set -o pipefail
  # Use pipe view (`pv`) to work around command line output timeout
  - mvn test $TEST_ARGS | pv -t -b -l -i 10
